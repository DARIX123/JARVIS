#:import dp kivy.metrics.dp

<ChatBubble>:
    size_hint_y: None
    padding: dp(10)
    text_size: self.width - dp(20), None
    halign: 'left'
    valign: 'middle'
    markup: True
    canvas.before:
        Color:
            rgba: self.bg_color
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [dp(10),]

<WaveIndicator>:
    canvas:
        Color:
            rgba: 0, 1, 1, 0.5
        Rectangle:
            pos: self.pos
            size: self.width * self.current_level, self.height

<JarvisLayout>:
    orientation: 'vertical'
    # enlaza con las propiedades de Python
    bg_color: root.bg_color
    fg_color: root.fg_color

    canvas.before:
        Color:
            rgba: root.bg_color
        Rectangle:
            pos: self.pos
            size: self.size

    # ── Cabecera ─────────────────────────────────────────────────────────────
    BoxLayout:
        size_hint_y: None
        height: dp(40)
        padding: dp(10), 0

        Label:
            text: '[b]🔷 JARVIS[/b]'
            markup: True
            color: root.fg_color
            halign: 'left'
            valign: 'middle'
            text_size: self.size

        Button:
            text: '🌙'
            size_hint_x: None
            width: dp(40)
            on_release: root.toggle_theme()

    # ── Historial de chat ────────────────────────────────────────────────────
    ScrollView:
        size_hint_y: 0.75
        do_scroll_x: False

        BoxLayout:
            id: chat_box
            orientation: 'vertical'
            size_hint_y: None
            height: self.minimum_height
            spacing: dp(10)
            padding: dp(10)

    # ── Indicador de nivel de voz ────────────────────────────────────────────
    WaveIndicator:
        size_hint_y: None
        height: dp(10)
        current_level: root.current_level

    # ── Zona de entrada fija ────────────────────────────────────────────────
    BoxLayout:
        size_hint_y: None
        height: dp(50)
        spacing: dp(10)
        padding: dp(10), 0

        TextInput:
            id: entrada_usuario
            hint_text: 'Escribe tu comando...'
            multiline: False
            on_text_validate: root.enviar_texto()

        Button:
            text: '🎙️'
            size_hint_x: None
            width: dp(50)
            on_release: root.hablar_con_jarvis()